{"version":3,"file":"watch.cjs","sources":["../../src/watch.ts"],"sourcesContent":["import chokidar from 'chokidar'\nimport {\n  Generator,\n  getConfig,\n  resolveConfigPath,\n} from '@tanstack/router-generator'\nimport type { FileEventType } from '@tanstack/router-generator'\n\nexport function watch(root: string) {\n  const configPath = resolveConfigPath({\n    configDirectory: root,\n  })\n  const configWatcher = chokidar.watch(configPath)\n\n  let watcher = new chokidar.FSWatcher({})\n\n  const generatorWatcher = () => {\n    const config = getConfig()\n    const generator = new Generator({ config, root })\n\n    watcher.close()\n\n    console.info(`TSR: Watching routes (${config.routesDirectory})...`)\n    watcher = chokidar.watch(config.routesDirectory)\n\n    watcher.on('ready', async () => {\n      const handle = async () => {\n        try {\n          await generator.run()\n        } catch (err) {\n          console.error(err)\n          console.info()\n        }\n      }\n\n      await handle()\n\n      watcher.on('all', (event, path) => {\n        let type: FileEventType | undefined\n        switch (event) {\n          case 'add':\n            type = 'create'\n            break\n          case 'change':\n            type = 'update'\n            break\n          case 'unlink':\n            type = 'delete'\n            break\n        }\n        if (type) {\n          return generator.run({ path, type })\n        }\n        return generator.run()\n      })\n    })\n  }\n\n  configWatcher.on('ready', generatorWatcher)\n  configWatcher.on('change', generatorWatcher)\n}\n"],"names":["resolveConfigPath","getConfig","Generator"],"mappings":";;;;AAQO,SAAS,MAAM,MAAc;AAClC,QAAM,aAAaA,gBAAAA,kBAAkB;AAAA,IACnC,iBAAiB;AAAA,EAAA,CAClB;AACK,QAAA,gBAAgB,SAAS,MAAM,UAAU;AAE/C,MAAI,UAAU,IAAI,SAAS,UAAU,CAAA,CAAE;AAEvC,QAAM,mBAAmB,MAAM;AAC7B,UAAM,SAASC,gBAAAA,UAAU;AACzB,UAAM,YAAY,IAAIC,gBAAAA,UAAU,EAAE,QAAQ,MAAM;AAEhD,YAAQ,MAAM;AAEd,YAAQ,KAAK,yBAAyB,OAAO,eAAe,MAAM;AACxD,cAAA,SAAS,MAAM,OAAO,eAAe;AAEvC,YAAA,GAAG,SAAS,YAAY;AAC9B,YAAM,SAAS,YAAY;AACrB,YAAA;AACF,gBAAM,UAAU,IAAI;AAAA,iBACb,KAAK;AACZ,kBAAQ,MAAM,GAAG;AACjB,kBAAQ,KAAK;AAAA,QAAA;AAAA,MAEjB;AAEA,YAAM,OAAO;AAEb,cAAQ,GAAG,OAAO,CAAC,OAAO,SAAS;AAC7B,YAAA;AACJ,gBAAQ,OAAO;AAAA,UACb,KAAK;AACI,mBAAA;AACP;AAAA,UACF,KAAK;AACI,mBAAA;AACP;AAAA,UACF,KAAK;AACI,mBAAA;AACP;AAAA,QAAA;AAEJ,YAAI,MAAM;AACR,iBAAO,UAAU,IAAI,EAAE,MAAM,MAAM;AAAA,QAAA;AAErC,eAAO,UAAU,IAAI;AAAA,MAAA,CACtB;AAAA,IAAA,CACF;AAAA,EACH;AAEc,gBAAA,GAAG,SAAS,gBAAgB;AAC5B,gBAAA,GAAG,UAAU,gBAAgB;AAC7C;;"}